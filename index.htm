<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fractal Viewer</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            overflow: hidden;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: #000;
        }

        #canvas {
            display: block;
            width: 100vw;
            height: 100vh;
        }

        .menu {
            position: fixed;
            top: 20px;
            left: 20px;
            background: rgba(255, 255, 255, 0.95);
            padding: 15px 20px;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
            min-width: 200px;
            z-index: 1000;
        }

        .menu h2 {
            font-size: 18px;
            margin-bottom: 12px;
            color: #333;
        }

        .menu-section {
            margin-bottom: 15px;
        }

        .menu-section:last-child {
            margin-bottom: 0;
        }

        .menu-section label {
            display: block;
            font-size: 12px;
            color: #666;
            margin-bottom: 5px;
            font-weight: 500;
        }

        .menu-section select,
        .menu-section input[type="number"] {
            width: 100%;
            padding: 6px 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
            background: white;
        }

        .button-group {
            display: flex;
            gap: 8px;
            margin-top: 10px;
        }

        button {
            flex: 1;
            padding: 8px 12px;
            border: none;
            border-radius: 4px;
            background: #4CAF50;
            color: white;
            font-size: 13px;
            cursor: pointer;
            transition: background 0.2s;
            font-weight: 500;
        }

        button:hover {
            background: #45a049;
        }

        button.secondary {
            background: #2196F3;
        }

        button.secondary:hover {
            background: #0b7dda;
        }

        .info {
            font-size: 11px;
            color: #888;
            margin-top: 10px;
            padding-top: 10px;
            border-top: 1px solid #eee;
        }

        .loading {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 15px 30px;
            border-radius: 8px;
            font-size: 14px;
            display: none;
        }

        .loading.active {
            display: block;
        }
    </style>
</head>
<body>
    <canvas id="canvas"></canvas>
    
    <div class="menu">
        <h2>Fractal Viewer</h2>
        
        <div class="menu-section">
            <label>Fractal Type</label>
            <select id="fractalType">
                <option value="mandelbrot">Mandelbrot Set</option>
            </select>
        </div>

        <div class="menu-section">
            <label>Max Iterations</label>
            <input type="number" id="maxIterations" value="100" min="10" max="1000" step="10">
        </div>

        <div class="button-group">
            <button id="resetBtn" class="secondary">Reset View</button>
            <button id="renderBtn">Render</button>
        </div>

        <div class="info">
            Click and drag to pan<br>
            Scroll to zoom<br>
            Double-click to zoom in
        </div>
    </div>

    <div class="loading" id="loading">Rendering...</div>

    <script>
        class FractalViewer {
            constructor() {
                this.canvas = document.getElementById('canvas');
                this.ctx = this.canvas.getContext('2d');
                this.loading = document.getElementById('loading');
                
                // Fractal parameters
                this.centerX = -0.5;
                this.centerY = 0;
                this.zoom = 1;
                this.maxIterations = 100;
                
                // Mouse interaction
                this.isDragging = false;
                this.lastX = 0;
                this.lastY = 0;
                
                this.setupCanvas();
                this.setupEventListeners();
                this.render();
            }

            setupCanvas() {
                this.canvas.width = window.innerWidth;
                this.canvas.height = window.innerHeight;
            }

            setupEventListeners() {
                // Window resize
                window.addEventListener('resize', () => {
                    this.setupCanvas();
                    this.render();
                });

                // Mouse dragging for panning
                this.canvas.addEventListener('mousedown', (e) => {
                    this.isDragging = true;
                    this.lastX = e.clientX;
                    this.lastY = e.clientY;
                });

                this.canvas.addEventListener('mousemove', (e) => {
                    if (this.isDragging) {
                        const dx = e.clientX - this.lastX;
                        const dy = e.clientY - this.lastY;
                        
                        const scale = 3.5 / (this.zoom * this.canvas.width);
                        this.centerX -= dx * scale;
                        this.centerY -= dy * scale;
                        
                        this.lastX = e.clientX;
                        this.lastY = e.clientY;
                        
                        this.render();
                    }
                });

                this.canvas.addEventListener('mouseup', () => {
                    this.isDragging = false;
                });

                this.canvas.addEventListener('mouseleave', () => {
                    this.isDragging = false;
                });

                // Mouse wheel for zooming
                this.canvas.addEventListener('wheel', (e) => {
                    e.preventDefault();
                    
                    const zoomFactor = e.deltaY > 0 ? 0.9 : 1.1;
                    const mouseX = e.clientX;
                    const mouseY = e.clientY;
                    
                    // Get world coordinates before zoom
                    const worldX = this.screenToWorldX(mouseX);
                    const worldY = this.screenToWorldY(mouseY);
                    
                    // Zoom
                    this.zoom *= zoomFactor;
                    
                    // Get world coordinates after zoom
                    const newWorldX = this.screenToWorldX(mouseX);
                    const newWorldY = this.screenToWorldY(mouseY);
                    
                    // Adjust center to keep mouse position fixed
                    this.centerX += worldX - newWorldX;
                    this.centerY += worldY - newWorldY;
                    
                    this.render();
                });

                // Double-click to zoom in
                this.canvas.addEventListener('dblclick', (e) => {
                    const worldX = this.screenToWorldX(e.clientX);
                    const worldY = this.screenToWorldY(e.clientY);
                    
                    this.centerX = worldX;
                    this.centerY = worldY;
                    this.zoom *= 2;
                    
                    this.render();
                });

                // Menu controls
                document.getElementById('maxIterations').addEventListener('change', (e) => {
                    this.maxIterations = parseInt(e.target.value);
                });

                document.getElementById('renderBtn').addEventListener('click', () => {
                    this.render();
                });

                document.getElementById('resetBtn').addEventListener('click', () => {
                    this.centerX = -0.5;
                    this.centerY = 0;
                    this.zoom = 1;
                    this.render();
                });
            }

            screenToWorldX(screenX) {
                const scale = 3.5 / (this.zoom * this.canvas.width);
                return this.centerX + (screenX - this.canvas.width / 2) * scale;
            }

            screenToWorldY(screenY) {
                const scale = 3.5 / (this.zoom * this.canvas.width);
                return this.centerY + (screenY - this.canvas.height / 2) * scale;
            }

            mandelbrot(cx, cy) {
                let x = 0;
                let y = 0;
                let iteration = 0;

                while (x * x + y * y <= 4 && iteration < this.maxIterations) {
                    const xtemp = x * x - y * y + cx;
                    y = 2 * x * y + cy;
                    x = xtemp;
                    iteration++;
                }

                return iteration;
            }

            getColor(iteration) {
                if (iteration === this.maxIterations) {
                    return [0, 0, 0];
                }

                // Smooth coloring using continuous iteration count
                const t = iteration / this.maxIterations;
                
                // Color palette: deep blues to bright cyans and purples
                const r = Math.floor(9 * (1 - t) * t * t * t * 255);
                const g = Math.floor(15 * (1 - t) * (1 - t) * t * t * 255);
                const b = Math.floor(8.5 * (1 - t) * (1 - t) * (1 - t) * t * 255);

                return [r, g, b];
            }

            async render() {
                this.loading.classList.add('active');
                
                // Small delay to allow UI to update
                await new Promise(resolve => setTimeout(resolve, 10));

                const width = this.canvas.width;
                const height = this.canvas.height;
                const imageData = this.ctx.createImageData(width, height);
                const data = imageData.data;

                const scale = 3.5 / (this.zoom * width);

                for (let py = 0; py < height; py++) {
                    for (let px = 0; px < width; px++) {
                        const x0 = this.centerX + (px - width / 2) * scale;
                        const y0 = this.centerY + (py - height / 2) * scale;

                        const iteration = this.mandelbrot(x0, y0);
                        const [r, g, b] = this.getColor(iteration);

                        const index = (py * width + px) * 4;
                        data[index] = r;
                        data[index + 1] = g;
                        data[index + 2] = b;
                        data[index + 3] = 255;
                    }
                }

                this.ctx.putImageData(imageData, 0, 0);
                this.loading.classList.remove('active');
            }
        }

        // Initialize the viewer when page loads
        window.addEventListener('load', () => {
            new FractalViewer();
        });
    </script>
</body>
</html>
